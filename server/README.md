# Server Benchmark

Machine:

HTTP Benchmarking Tools:

* [autocannon](https://github.com/mcollina/autocannon)
* [wrk2](https://github.com/giltene/wrk2)

Node.js HTTP Servers:

* [fastify](https://github.com/fastify/fastify)
* [express](https://github.com/expressjs/express)

Route:

1. Return an `application/json` with `{ "hello": "world" }`.
2. Return an `text/plain` with `"hello world"`.

## Results

### Plain Text

#### Node.js 20

Express

```console
root@ip-10-30-173-152:/opt# npx autocannon -c 500 -d 120 -W [ -c 50 -d 5 ] http://localhost:3000/plain
Running 5s warmup @ http://localhost:3000/plain
50 connections

Running 120s test @ http://localhost:3000/plain
500 connections


┌─────────┬───────┬───────┬───────┬───────┬──────────┬─────────┬────────┐
│ Stat    │ 2.5%  │ 50%   │ 97.5% │ 99%   │ Avg      │ Stdev   │ Max    │
├─────────┼───────┼───────┼───────┼───────┼──────────┼─────────┼────────┤
│ Latency │ 41 ms │ 45 ms │ 68 ms │ 69 ms │ 49.66 ms │ 8.81 ms │ 134 ms │
└─────────┴───────┴───────┴───────┴───────┴──────────┴─────────┴────────┘
┌───────────┬─────────┬─────────┬─────────┬─────────┬──────────┬────────┬─────────┐
│ Stat      │ 1%      │ 2.5%    │ 50%     │ 97.5%   │ Avg      │ Stdev  │ Min     │
├───────────┼─────────┼─────────┼─────────┼─────────┼──────────┼────────┼─────────┤
│ Req/Sec   │ 8,311   │ 8,519   │ 9,975   │ 11,127  │ 9,966.89 │ 694.6  │ 7,807   │
├───────────┼─────────┼─────────┼─────────┼─────────┼──────────┼────────┼─────────┤
│ Bytes/Sec │ 1.98 MB │ 2.03 MB │ 2.37 MB │ 2.65 MB │ 2.37 MB  │ 165 kB │ 1.86 MB │
└───────────┴─────────┴─────────┴─────────┴─────────┴──────────┴────────┴─────────┘

Req/Bytes counts sampled once per second.
# of samples: 120

1196k requests in 120.05s, 285 MB read
```

Fastify

```console
root@ip-10-30-173-152:/opt# npx autocannon -c 500 -d 120 -W [ -c 50 -d 5 ] http://localhost:3000/plain
Running 5s warmup @ http://localhost:3000/plain
50 connections

Running 120s test @ http://localhost:3000/plain
500 connections


┌─────────┬──────┬──────┬───────┬───────┬─────────┬─────────┬────────┐
│ Stat    │ 2.5% │ 50%  │ 97.5% │ 99%   │ Avg     │ Stdev   │ Max    │
├─────────┼──────┼──────┼───────┼───────┼─────────┼─────────┼────────┤
│ Latency │ 6 ms │ 7 ms │ 9 ms  │ 13 ms │ 7.43 ms │ 1.33 ms │ 435 ms │
└─────────┴──────┴──────┴───────┴───────┴─────────┴─────────┴────────┘
┌───────────┬─────────┬─────────┬─────────┬─────────┬───────────┬──────────┬─────────┐
│ Stat      │ 1%      │ 2.5%    │ 50%     │ 97.5%   │ Avg       │ Stdev    │ Min     │
├───────────┼─────────┼─────────┼─────────┼─────────┼───────────┼──────────┼─────────┤
│ Req/Sec   │ 59,231  │ 60,415  │ 62,495  │ 63,455  │ 62,347.74 │ 1,066.74 │ 53,763  │
├───────────┼─────────┼─────────┼─────────┼─────────┼───────────┼──────────┼─────────┤
│ Bytes/Sec │ 9.54 MB │ 9.72 MB │ 10.1 MB │ 10.2 MB │ 10 MB     │ 172 kB   │ 8.66 MB │
└───────────┴─────────┴─────────┴─────────┴─────────┴───────────┴──────────┴─────────┘

Req/Bytes counts sampled once per second.
# of samples: 120

7482k requests in 120.05s, 1.2 GB read
```

#### Node.js 22

Express

```console
root@ip-10-30-173-152:/opt# npx autocannon -c 500 -d 120 -W [ -c 50 -d 5 ] http://localhost:3000/plain
Running 5s warmup @ http://localhost:3000/plain
50 connections

Running 120s test @ http://localhost:3000/plain
500 connections


┌─────────┬───────┬───────┬───────┬───────┬──────────┬─────────┬────────┐
│ Stat    │ 2.5%  │ 50%   │ 97.5% │ 99%   │ Avg      │ Stdev   │ Max    │
├─────────┼───────┼───────┼───────┼───────┼──────────┼─────────┼────────┤
│ Latency │ 43 ms │ 45 ms │ 70 ms │ 70 ms │ 49.89 ms │ 8.69 ms │ 155 ms │
└─────────┴───────┴───────┴───────┴───────┴──────────┴─────────┴────────┘
┌───────────┬─────────┬─────────┬─────────┬─────────┬──────────┬────────┬─────────┐
│ Stat      │ 1%      │ 2.5%    │ 50%     │ 97.5%   │ Avg      │ Stdev  │ Min     │
├───────────┼─────────┼─────────┼─────────┼─────────┼──────────┼────────┼─────────┤
│ Req/Sec   │ 8,039   │ 8,175   │ 9,959   │ 10,951  │ 9,921.09 │ 722.78 │ 7,337   │
├───────────┼─────────┼─────────┼─────────┼─────────┼──────────┼────────┼─────────┤
│ Bytes/Sec │ 1.91 MB │ 1.95 MB │ 2.37 MB │ 2.61 MB │ 2.36 MB  │ 172 kB │ 1.75 MB │
└───────────┴─────────┴─────────┴─────────┴─────────┴──────────┴────────┴─────────┘

Req/Bytes counts sampled once per second.
# of samples: 120

1191k requests in 120.05s, 283 MB read
```

Fastify

```
root@ip-10-30-173-152:/opt# npx autocannon -c 500 -d 120 -W [ -c 50 -d 5 ] http://localhost:3000/plain
Running 5s warmup @ http://localhost:3000/plain
50 connections

Running 120s test @ http://localhost:3000/plain
500 connections


┌─────────┬───────┬───────┬───────┬───────┬──────────┬─────────┬───────┐
│ Stat    │ 2.5%  │ 50%   │ 97.5% │ 99%   │ Avg      │ Stdev   │ Max   │
├─────────┼───────┼───────┼───────┼───────┼──────────┼─────────┼───────┤
│ Latency │ 12 ms │ 13 ms │ 14 ms │ 21 ms │ 13.12 ms │ 1.53 ms │ 95 ms │
└─────────┴───────┴───────┴───────┴───────┴──────────┴─────────┴───────┘
┌───────────┬─────────┬─────────┬─────────┬─────────┬───────────┬────────┬─────────┐
│ Stat      │ 1%      │ 2.5%    │ 50%     │ 97.5%   │ Avg       │ Stdev  │ Min     │
├───────────┼─────────┼─────────┼─────────┼─────────┼───────────┼────────┼─────────┤
│ Req/Sec   │ 35,263  │ 35,423  │ 37,343  │ 37,983  │ 37,118.67 │ 627.09 │ 35,178  │
├───────────┼─────────┼─────────┼─────────┼─────────┼───────────┼────────┼─────────┤
│ Bytes/Sec │ 5.67 MB │ 5.71 MB │ 6.01 MB │ 6.12 MB │ 5.98 MB   │ 101 kB │ 5.66 MB │
└───────────┴─────────┴─────────┴─────────┴─────────┴───────────┴────────┴─────────┘

Req/Bytes counts sampled once per second.
# of samples: 120

4455k requests in 120.05s, 717 MB read
```

### JSON

Express:

```console
root@ip-10-30-173-152:/opt# npx autocannon -c 500 -d 120 -W [ -c 50 -d 5 ] http://localhost:3000/json
Running 5s warmup @ http://localhost:3000/json
50 connections

Running 120s test @ http://localhost:3000/json
500 connections


┌─────────┬───────┬───────┬───────┬───────┬──────────┬─────────┬────────┐
│ Stat    │ 2.5%  │ 50%   │ 97.5% │ 99%   │ Avg      │ Stdev   │ Max    │
├─────────┼───────┼───────┼───────┼───────┼──────────┼─────────┼────────┤
│ Latency │ 42 ms │ 46 ms │ 70 ms │ 71 ms │ 50.36 ms │ 9.07 ms │ 136 ms │
└─────────┴───────┴───────┴───────┴───────┴──────────┴─────────┴────────┘
┌───────────┬─────────┬─────────┬─────────┬─────────┬──────────┬────────┬─────────┐
│ Stat      │ 1%      │ 2.5%    │ 50%     │ 97.5%   │ Avg      │ Stdev  │ Min     │
├───────────┼─────────┼─────────┼─────────┼─────────┼──────────┼────────┼─────────┤
│ Req/Sec   │ 7,963   │ 7,991   │ 9,943   │ 10,871  │ 9,831.14 │ 753.24 │ 7,349   │
├───────────┼─────────┼─────────┼─────────┼─────────┼──────────┼────────┼─────────┤
│ Bytes/Sec │ 2.01 MB │ 2.01 MB │ 2.51 MB │ 2.74 MB │ 2.48 MB  │ 190 kB │ 1.85 MB │
└───────────┴─────────┴─────────┴─────────┴─────────┴──────────┴────────┴─────────┘

Req/Bytes counts sampled once per second.
# of samples: 120

1180k requests in 120.06s, 297 MB read
```

Fastify

```console
root@ip-10-30-173-152:/opt/node/node# npx autocannon -c 500 -d 120 -W [ -c 50 -d 5 ] http://localhost:3000/json
Running 5s warmup @ http://localhost:3000/json
50 connections

Running 120s test @ http://localhost:3000/json
500 connections


┌─────────┬──────┬──────┬───────┬───────┬─────────┬────────┬───────┐
│ Stat    │ 2.5% │ 50%  │ 97.5% │ 99%   │ Avg     │ Stdev  │ Max   │
├─────────┼──────┼──────┼───────┼───────┼─────────┼────────┼───────┤
│ Latency │ 7 ms │ 8 ms │ 9 ms  │ 14 ms │ 8.08 ms │ 1.1 ms │ 94 ms │
└─────────┴──────┴──────┴───────┴───────┴─────────┴────────┴───────┘
┌───────────┬─────────┬─────────┬────────┬─────────┬───────────┬────────┬─────────┐
│ Stat      │ 1%      │ 2.5%    │ 50%    │ 97.5%   │ Avg       │ Stdev  │ Min     │
├───────────┼─────────┼─────────┼────────┼─────────┼───────────┼────────┼─────────┤
│ Req/Sec   │ 56,543  │ 56,863  │ 58,687 │ 59,903  │ 58,593.87 │ 807.74 │ 54,379  │
├───────────┼─────────┼─────────┼────────┼─────────┼───────────┼────────┼─────────┤
│ Bytes/Sec │ 10.6 MB │ 10.7 MB │ 11 MB  │ 11.3 MB │ 11 MB     │ 152 kB │ 10.2 MB │
└───────────┴─────────┴─────────┴────────┴─────────┴───────────┴────────┴─────────┘

Req/Bytes counts sampled once per second.
# of samples: 120

7032k requests in 120.06s, 1.32 GB read
```

#### Node.js 22

Express /json

```
root@ip-10-30-173-152:/opt/node/node# npx autocannon -c 500 -d 120 -W [ -c 50 -d 5 ] http://localhost:3000/json
Running 5s warmup @ http://localhost:3000/json
50 connections

Running 120s test @ http://localhost:3000/json
500 connections


┌─────────┬───────┬───────┬───────┬───────┬──────────┬─────────┬────────┐
│ Stat    │ 2.5%  │ 50%   │ 97.5% │ 99%   │ Avg      │ Stdev   │ Max    │
├─────────┼───────┼───────┼───────┼───────┼──────────┼─────────┼────────┤
│ Latency │ 45 ms │ 47 ms │ 71 ms │ 72 ms │ 51.97 ms │ 8.51 ms │ 141 ms │
└─────────┴───────┴───────┴───────┴───────┴──────────┴─────────┴────────┘
┌───────────┬───────┬────────┬─────────┬─────────┬──────────┬────────┬─────────┐
│ Stat      │ 1%    │ 2.5%   │ 50%     │ 97.5%   │ Avg      │ Stdev  │ Min     │
├───────────┼───────┼────────┼─────────┼─────────┼──────────┼────────┼─────────┤
│ Req/Sec   │ 7,939 │ 8,327  │ 9,591   │ 10,471  │ 9,528.97 │ 662.1  │ 7,296   │
├───────────┼───────┼────────┼─────────┼─────────┼──────────┼────────┼─────────┤
│ Bytes/Sec │ 2 MB  │ 2.1 MB │ 2.42 MB │ 2.64 MB │ 2.4 MB   │ 167 kB │ 1.84 MB │
└───────────┴───────┴────────┴─────────┴─────────┴──────────┴────────┴─────────┘

Req/Bytes counts sampled once per second.
# of samples: 120

1144k requests in 120.05s, 288 MB read
```

Fastify /json

```
root@ip-10-30-173-152:/opt/node/node# npx autocannon -c 500 -d 120 -W [ -c 50 -d 5 ] http://localhost:3000/json
Running 5s warmup @ http://localhost:3000/json
50 connections

Running 120s test @ http://localhost:3000/json
500 connections


┌─────────┬───────┬───────┬───────┬───────┬──────────┬────────┬───────┐
│ Stat    │ 2.5%  │ 50%   │ 97.5% │ 99%   │ Avg      │ Stdev  │ Max   │
├─────────┼───────┼───────┼───────┼───────┼──────────┼────────┼───────┤
│ Latency │ 12 ms │ 13 ms │ 14 ms │ 21 ms │ 12.84 ms │ 1.6 ms │ 93 ms │
└─────────┴───────┴───────┴───────┴───────┴──────────┴────────┴───────┘
┌───────────┬─────────┬─────────┬─────────┬─────────┬───────────┬────────┬─────────┐
│ Stat      │ 1%      │ 2.5%    │ 50%     │ 97.5%   │ Avg       │ Stdev  │ Min     │
├───────────┼─────────┼─────────┼─────────┼─────────┼───────────┼────────┼─────────┤
│ Req/Sec   │ 34,879  │ 35,263  │ 37,759  │ 38,431  │ 37,549.07 │ 723.21 │ 34,778  │
├───────────┼─────────┼─────────┼─────────┼─────────┼───────────┼────────┼─────────┤
│ Bytes/Sec │ 6.56 MB │ 6.63 MB │ 7.09 MB │ 7.22 MB │ 7.06 MB   │ 136 kB │ 6.54 MB │
└───────────┴─────────┴─────────┴─────────┴─────────┴───────────┴────────┴─────────┘

Req/Bytes counts sampled once per second.
# of samples: 120

4506k requests in 120.06s, 847 MB read
```
